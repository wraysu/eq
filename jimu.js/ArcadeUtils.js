// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://@sbaseurl@/jsapi/jsapi/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","jimu/LayerStructure"],function(g,e,f,h){return g([],{declaredClass:"ArcadeUtils",map:null,constructor:function(a){g.safeMixin(this,a)},getArcadeRender:function(a){return{ArcadeRender:this._lookupArcadeRender({layers:this._checkPassInLayer(a)})}},getArcadeInfoTemplate:function(a){return{ArcadeInfoTemplate:this._lookupArcadeInfoTemplate({layers:this._checkPassInLayer(a)})}},getArcadeLabel:function(a){return{ArcadeLabel:this._lookupArcadeLabel({layers:this._checkPassInLayer(a)})}},
getAllArcade:function(a){var d=this.getArcadeInfoTemplate(a),c=this.getArcadeRender(a);a=this.getArcadeLabel(a);return Object.assign(d,c,a)},_checkPassInLayer:function(a){var d=[];return d="undefined"!==typeof a?"undefined"!==typeof a.layer?null!==a.layer&&""!==a.layer?this._getAllMapLayers(a):this._getAllMapLayers():this._getAllMapLayers():this._getAllMapLayers()},_getAllMapLayers:function(a){var d="",c=[],b=h.getInstance();"undefined"!==typeof a&&(d=a.layer);""!==d?(a=b.getNodeById(d),"undefined"!==
a&&c.push(a._layerInfo.layerObject)):b.traversal(function(a){"undefined"!==typeof a._layerInfo.layerObject.type?-1===a._layerInfo.layerObject.type.indexOf("tile")&&c.push(a._layerInfo.layerObject):c.push(a._layerInfo.layerObject)});return c},_lookupArcadeRender:function(a){var d=[];0<a.layers.length&&f.forEach(a.layers,e.hitch(this,function(a){var b={};if("undefined"!=typeof a.renderer){var c=a.renderer;"undefined"!==typeof c.valueExpression&&(b.layer=a.id,b.valueExpression=c.valueExpression,b.valueExpressionTitle=
c.valueExpressionTitle,"undefined"!==typeof c.values&&(b.values=c.values),"undefined"!==typeof c.visualVariables&&(b.visualVariables=c.visualVariables));1<Object.keys(b).length&&b.constructor===Object&&d.push(b)}}));return d},_lookupArcadeInfoTemplate:function(a){var d=[];0<a.layers.length&&f.forEach(a.layers,e.hitch(this,function(a){var b={};if("undefined"!==typeof a.infoTemplate)"undefined"!==typeof a.infoTemplate.info.expressionInfos&&0<a.infoTemplate.info.expressionInfos.length&&(b.layer=a.id,
b.expressionInfos=a.infoTemplate.info.expressionInfos);else if("undefined"!==typeof a.infoTemplates)for(var c in a.infoTemplates)if(a.infoTemplates.hasOwnProperty(c)&&"undefined"!==typeof a.infoTemplates[c].infoTemplate.info.expressionInfos){var e=a.infoTemplates[c].infoTemplate;0<e.info.expressionInfos.length&&(b.layer=a.id,b.expressionInfos=e.info.expressionInfos)}1<Object.keys(b).length&&b.constructor===Object&&d.push(b)}));return d},_lookupArcadeLabel:function(a){var d=[];0<a.layers.length&&f.forEach(a.layers,
e.hitch(this,function(a){var b={};"undefined"!==typeof a.labelingInfo&&f.forEach(a.labelingInfo,e.hitch(this,function(c){"undefined"!==typeof c.name&&(b.layer=a.id,b.labelingInfo=c)}));1<Object.keys(b).length&&b.constructor===Object&&d.push(b)}));return d}})});