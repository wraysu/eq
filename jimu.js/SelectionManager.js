// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://@sbaseurl@/jsapi/jsapi/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),function(u,v,d,f,g,h,w,l,p,m,q,r,t){var k=null,n=u(null,{constructor:function(){window.isBuilder?(g.subscribe("app/mapLoaded",d.hitch(this,this._onMapLoaded)),g.subscribe("app/mapChanged",d.hitch(this,this._onMapChanged))):
(g.subscribe("mapLoaded",d.hitch(this,this._onMapLoaded)),g.subscribe("mapChanged",d.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(a){var b=a.geometryType,e=new q(q.STYLE_CIRCLE,16,null,m.fromArray([0,255,255])),c=new r(r.STYLE_SOLID,m.fromArray([0,255,255]),2),x=new t(t.STYLE_SOLID,c,m.fromArray([0,255,255,.3]));"esriGeometryPoint"===b?a.setSelectionSymbol(e):"esriGeometryPolyline"===b?a.setSelectionSymbol(c):"esriGeometryPolygon"===b&&a.setSelectionSymbol(x)},updateSelectionByFeatures:function(a,
b,e){0<b.length&&(b=f.map(b,d.hitch(this,function(b){var c=null,c=0<=a.graphics.indexOf(b)?new p(b.toJson()):b;c.wabIsTemp=!0;return c})));a.getSelectionSymbol()||this.setSelectionSymbol(a);var c=new v;a._selectHandler({features:b},e,null,null,c);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return c},getDisplayLayer:function(a){return this._displayLayers[a]},setSelection:function(a,b){return this.updateSelectionByFeatures(a,
b,h.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,h.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,h.SELECTION_SUBTRACT)},clearSelection:function(a){this.clearDisplayLayer(a);return this.updateSelectionByFeatures(a,[],h.SELECTION_NEW)},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(a,b,e){return f.filter(a.graphics,d.hitch(this,function(a){return e?
l.contains(b,a.geometry):l.intersects(b,a.geometry)}))},getUnionGeometryBySelectedFeatures:function(a){var b=null;a=a.getSelectedFeatures();0<a.length&&(b=f.map(a,d.hitch(this,function(a){return a.geometry})),b=l.union(b));return b},_createDisplayLayer:function(a){var b=new w;b.id="displayLayer_of_"+a.id;this.map.addLayer(b);return b},_updateDisplayLayer:function(a){var b=a.getSelectedFeatures(),e=this._displayLayers[a.id];this.clearDisplayLayer(a);var c=a.getSelectionSymbol();f.forEach(b,d.hitch(this,
function(a){a.setSymbol(null);a=new p(a.toJson());a.setSymbol(c);e.add(a)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});n.getInstance=function(){k||(k=new n,window._selectionManager=k);return k};return n});